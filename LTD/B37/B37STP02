.pm 20mm
.BR
.NV PAGE BANKSTED '%&EKSPBNKST.'
.BR
.NV PAGE BANK-EKSPEDIENT '%&BRUGERNR.'
.BR
.NV PAGE PRINTER '%&PRINTER.'
.BR
.NV PAGE TØMPOSTKASSE '%&U'&TØMPOST.'
.BR
.NV PAGE FORCERTØM '%&U'&FORCER.'
.BR
.NV PAGE PDFFORMAT '%&U'&PDFFORMAT.'
.* MODULUSKONTROL
.bkmo &B37REGKTO
.bkmo &B37REGKTO1
.bkmo &B37REGKTO2
.bkmo &B37REGKTO3
.bkmo &B37REGKTO4
.bkmo &B37REGKTO5
.bkmo &B37REGKTO6
.bkmo &B37REGKTO7
.*if x&fejl ne x1
.*th .go BKMOOK
.*mg /t/  rettes før brevet kan udskrives
...BKMOOK
.IBAN &B37REGKTO &B37N20
.IBAN &B37REGKTO1 &B37N21
.IBAN &B37REGKTO2 &B37N22
.IBAN &B37REGKTO3 &B37N23
.IBAN &B37REGKTO4 &B37N24
.IBAN &B37REGKTO5 &B37N25
.IBAN &B37REGKTO6 &B37N26
.IBAN &B37REGKTO7 &B37N27
.if x&fejl ne x1
.th .go IBANOK
.mg /t/  rettes før brevet kan udskrives
...IBANOK
.DA BRTXT 20mm 100mm WIDTH 195mm
.AR BRTXT on
.ir 20mm
:FED.
Handel med udlandet og nye regler vedr. IBAN - International Bank
Account Number og BIC - Bank Identifier Code (SWIFT adresse)
:SKRSLUT.
.hr left 173mm
 
.us Fra 1. juli 2003
vil &DIT. IBAN og bankens BIC (SWIFT
adresse) fremgå af &DIT. kontoudtog, og fra denne dag er bankerne
- iflg. EU-reglerne - berettiget til at opkræve ekstra gebyr for
en overførsel, hvis IBAN og BIC ikke er opgivet.
 
:FED.
.us Hvad er IBAN
:SKRSLUT.
.sp 2mm
IBAN er et internationalt kontonummer og tager sit udgangspunkt i
virksomhedens nuværende registrerings- og
kontonummer. IBAN anvendes p.t. kun i Europa.
 
Ud fra nummeret er det muligt entydigt at identificere
beløbmodtagers konto, pengeinstitut, afdeling samt land. Det er
gratis for virksomhederne at få et IBAN-nummer.
 
:FED.
.us Fordele
:SKRSLUT.
.sp 2mm
 * Er med til at sikre, at kontonummeret er korrekt angivet
 * Er med til at sikre hurtig, pålidelig og effektiv håndtering af
internationale
   betalinger
 * Er med til at reducere omkostninger og tab af valørdage
 
:FED.
.us Sådan anvendes IBAN
 
.in +7mm
Betalinger TIL udlandet
:SKRSLUT.
.sp 1mm
Ved betalinger til udlandet skal IBAN på den
udenlandske forretningsforbindelse anvendes.
 
:FED.
Betalinger FRA udlandet
:SKRSLUT.
.sp 1mm
Ved fakturering og indgåelse af kontrakter med udlandet, skal
&DU. - tillige med bankens BIC - anføre &DIT. IBAN
på den konto, hvorpå beløbet ønskes indsat.
.in -7mm
.sp 10mm
.ri fortsættes
.ar off
.pa
:FED.
.us Sådan ser IBAN ud
:SKRSLUT.
.sp 2mm
IBAN er elektronisk opbygget og består af max. 34 alfanumeriske
karakterer. I Danmark er IBAN-standarden dog på kun i alt
:FED.
.us 18 karakterer:
:SKRSLUT.
 
 *  2 bogstaver for landekoden DK
.sp 1mm
 *  2 tal, der er en kontrolnøgle
.sp 1mm
.of 7mm
 * 14 tal, der svarer til virksomhedens nuværende kontonummer i
&BANKNAVN.. De fire første tal er registreringsnummer,
de sidste ti cifre er afsat til kontonummeret, og da
bankens kontonummer består af syv cifre, er der foranstillet
tre nuller.
.of
 
&SDIT. elektroniske IBAN skrives som følger her:
 
.in +47mm
:FED.
Reg. Konto   = IBAN
:SKRSLUT.
.sp 2mm
&IBAN1
.sp 1mm
&IBAN2
.sp 1mm
&IBAN3
.sp 1mm
&IBAN4
.sp 1mm
&IBAN5
.sp 1mm
&IBAN6
.sp 1mm
&IBAN7
.sp 1mm
&IBAN8
.in -47mm
 
Har &DU. behov for at få IBAN-numre på andre konti, eller har &DU.
spørgsmål i denne forbindelse, er &DU. velkommen til at kontakte
undertegnede.
.* GENEKSP      MIBAFSU1
.* GENTITEL     MIBAFSSU1
.* GENMEKSP     MIBAFSU2
.* GENMTITEL    MIBAFSSU2
.se brevs = (B37HILS)
.se B37HILS = 1
.* HVIS parametren  B37MTIT = J medtages titler
.* HVIS parametrene AFDNAVN og afdnavn EKSISTERER MEDTAGES AFDELINGSNAVN
.* PARAMETREN fixk JUSTERER MVH PÅ SIDEN - standard 43
.* ANTAL UNDERSKRIFTER (B37ANTUSK) - standard 1 (9 = ingen afslutning)
.if &E'&B37ANTUSK = 0
.th .se B37ANTUSK = 1
.if .&B37ANTUSK = .9 .go EJ9
.ti ^ 05
.* HVIS parametren  B37MTIT = J medtages titler
.if &E'&B37MTIT = 0
.th .go TIT
.if &U'&B37MTIT = J
.th .go MTIT
.el .go TIT
...TIT
.se GENTITEL ''
.se GENMTITEL ''
...MTIT
.* JUSTERING AF AFSTAND VED UNDERSKRIFTER
.if .&ÅLC < .17
.th .se T = 1
.if .&T = .1
.th .sk 3
.el .sk 4
.* OMREGN COURIER 12 til mm
.se mmt = 25
.if &E'&fixk = 0
.th .se fixk = 43
.if &E'&mmd  = 0
.th .se mmd  = 12
.se fixmm = &fixk.*&mmt./&mmd
.tp &fixmm.mm center
 ^ Med venlig hilsen
.*sk
.* ^ M i d t b a n k
.if &E'&AFDNAVN = 1 .an &E'&afdnavn = 1
.th .sk
.th ^ &AFDNAVN
.if .&T = .1
.th .sk 3
.el .sk 4
.if .&B37ANTUSK ne .1 .go EJ1
 ^ &GENEKSP
.br
 ^ &GENTITEL
...EJ1
.if .&B37ANTUSK ne .2 .go EJ2
.se MIBTAB1 = &L'&GENMEKSP - &L'&GENMTITEL
.if &MIBTAB1 > 0
.th .se mibl2 = &L'&GENMEKSP
.el .se mibl2 = &L'&GENMTITEL
.se MIBTAB2 = &L'&GENEKSP - &L'&GENTITEL
.if &MIBTAB2 > 0
.th .se mibl1 = &L'&GENEKSP
.el .se mibl1 = &L'&GENTITEL
.if &mibl2 > &mibl1
.th .se mibdiff = &mibl2 - &mibl1
.th .se mibtab1 = &fixk - &mibl2 - 2
.th .se mibtab2 = &fixk + &mibdiff + 2
.el .se mibdiff = &mibl1 - &mibl2
.el .se mibtab1 = &fixk - &mibl2 - &mibdiff - 2
.el .se mibtab2 = &fixk + 2
.se mibtab1m = &mibtab1 * &mmt / &mmd
.se mibtab2m = &mibtab2 * &mmt / &mmd
.tp set &mibtab1m.mm &mibtab2m.mm
 ^ &GENMEKSP ^ &GENEKSP
.br
 ^ &GENMTITEL ^ &GENTITEL
...EJ2
.tp
.br
...EJ9
:NY.
.NV PAGE ARKIV '%&ARKIV.'
.BR
.NV PAGE SENDKUNDE '%&SANTKUNDE.'
.BR
.NV PAGE SENDBANK '%&SANTBANK.'
.BR
.NV PAGE UDDATAKAT '%&UDDATA.'
.BR
.NV PAGE UDDATANAVN1 '%&UDDATANVN1.'
.BR
.NV PAGE UDDATANAVN2 '%&UDDATANVN2.'
.BR
.NV PAGE KUNDENR '%&KUNDENR.'
.BR
.NV PAGE ADRESSENØGLE '%&IFORSEND.'
.BR
.NV PAGE UDDATASPROGKODE '%1'
.BR
.NV PAGE KONTROLLANT1 '%&KONTROL1.'
.BR
.NV PAGE KONTROLLANT2 '%&KONTROL2.'
.BR
:ENY.
.* NAVNEMODUL TIL VISNING PÅ SKÆRM
:GL.
&STILL
.BR
&NAVN
.BR
&COADR
.BR
&GADE
.BR
&BY  &LAND
.SK
:EGL.
.SE B37KUDAL = 1
.dr tynd WEIGHT 0.1mm
.LL 175mm
.fo left
.PM 0
.******************* Evt. ALTERNATIV PRINTER ******
.* Til alternativ print skal bruges parametrene
.* PRTVALG        (J/N/alt.printer):
.* ALTPRINTER     Brugerafh.printer:
.if &E'&PRTVALG = 0 .go EJALT
:altprint &PRTVALG
...EJALT
.**************************************************
.* Standardparam plus kode rettet fra TILTALEF til TILTALEM d.19.1.2001es
.if &E'&TILTALEM = 0 .an &E'&TILTALEF = 1
.th .se TILTALEM = &TILTALEF
.if &E'&TILTALEM = 0 .an &E'&TILTALEF = 0
.th .se TILTALEM = du
:TILTALE &TILTALEM
...EJTILT
.******************* ATT FELT I ADR. **************
.if &E'&GENATT = 0
.th .go EJATT
.if &L'&GENATT = 0
.th .go EJATT
.* Att placeret i adresseruden mellem adresse og evt. KOPI
.* Att korrigeret for flytning af adresefelt D / C d. 13.10.2000
.if .&U'&UDSKRSTED = .D
.th .da ATT 24mm 68.5mm width 180mm
.el .da ATT 20mm 68.5mm width 180mm
.ar ATT on
:COUR10.
Att.: &GENATT
.ar off
...EJATT
.********************ROTERET BREVNAVN**************
.if &E'&B37BREV = 0 .an &E'&BREVNAVN = 1
.th .se B37BREV = '&BREVNAVN.'
.if &E'&B37BREV = 0
.th .go EJROT
.if &L'&B37BREV = 0
.th .go EJROT
.* Brevnavn, roteret i venstre hjørne
.da VEND 7mm 277mm width 180mm rotate -90
.ar VEND on
:COUR6.
&B37BREV.
.ar off
...EJROT
.**************************************************
.ti ^ 05
:COUR10.
.**************************************************
.* PM og TM virker først fra side 2
.PM 20mm
.TM 35mm
.**************************************************
.DA BRTXT 20mm 100mm WIDTH 195mm
.*AR BRTXT on
.*ir 20mm
.* Parameterafsn.
.se B37MO10CHK=1
.*
.dm MO10CHK on
.if &E'&*1 = 0 .se MO10CHK=1
.th .go SLUT2
.se kto=&*1
.se MOREGNR=substr &kto 1 4
.if .&U'&*2. = .DEPOT
.th .se MOKTONR=substr &kto 5 5
.th .se MOK    =substr &kto 10 1
.el .se MOKTONR=substr &kto 5 6
.el .se MOK    =substr &kto 11 1
.se LOOPEXIT = 0
.se TLR = 1
.*
...BEREGN
.se LOOPEXIT = 0
...NUL
.se LOOPEXIT = &LOOPEXIT + 1
.if &LOOPEXIT > 20
.th .QQ
.if &L'&MOKTONR < 6
.th .se MOKTONR = 0&MOKTONR
.th .go NUL
.se NR = &MOREGNR.&MOKTONR
.se F1 = 0
.se F2 = 0
.se KNR = 1
...LOOPUD
.se LOOPEXIT = &LOOPEXIT + 1
.if &LOOPEXIT > 20
.th .QQ
.se TEST = substr &NR &KNR 1
.if .&TEST = .
.th .go SLUTUD
.se F1 = &F1.&TEST
.se KNR = &KNR + 1
.se TEST = substr &NR &KNR 1
.if .&TEST = .
.th .go SLUTUD
.se F2 = &F2.&TEST
.se KNR = &KNR + 1
.go LOOPUD
.*
...SLUTUD
.se F2 = &F2 * 2
...TVAERSUM
.se SUMF1 = 0
.se KNR = 1
.se LOOPEXIT = 0
...LOOPTV1
.se LOOPEXIT = &LOOPEXIT + 1
.if &LOOPEXIT > 20
.th .QQ
.se TEST = substr &F1 &KNR 1
.if .&TEST = .
.th .go TVF2
.se SUMF1 = &SUMF1 + &TEST
.se KNR = &KNR + 1
.go LOOPTV1
...TVF2
.se SUMF2 = 0
.se KNR = 1
.se LOOPEXIT = 0
...LOOPTV2
.se LOOPEXIT = &LOOPEXIT + 1
.if &LOOPEXIT > 20
.th .QQ
.se TEST = substr &F2 &KNR 1
.if .&TEST = .
.th .go SLUTTV
.se SUMF2 = &SUMF2 + &TEST
.se KNR = &KNR + 1
.go LOOPTV2
...SLUTTV
.se TVSUM = &SUMF1 + &SUMF2
.se TVSUM = substr &TVSUM 2 1
.if .&TVSUM = .0
.th .se KONTROL = 0
.el .se KONTROL = 10 - &TVSUM
.*
...SLUT
.if .&MOK = .&KONTROL
.th .se MO10CHK=1
.el .se MO10CHK=0
.*
.go SLUT2
kto=&kto           ;.br
moregnr = &MOREGNR ;.br
moktonr = &MOKTONR ;.br
mok     = &MOK     ;.br
kontrol = &KONTROL ;.br
mo10chk = &MO10CHK ;.br
.*
...SLUT2
.dm off
.**  MO11CHK - Macro til modulus 11 check
.**  MO11CHK kunde/regkto/regdepot  ''/depot/cpr/cpr/vis vis
.se B37MO11CHK=1
.*
.dm MO11CHK on
.if &E'&*1 = 0 .se MO11CHK=1
.th .go SLUT2
.se kto=&*1
.***
...CPR
.if .&U'&*2 = .CPR
.or .&U'&*2 = .CVR
.el .go CPRUD
.se LOOPEXIT = 0
...NULCPR
.se LOOPEXIT = &LOOPEXIT + 1
.if &LOOPEXIT > 15
.th .QQ
.***
.if &L'&kto < 11
.th .se kto = 0&kto
.th .go NULCPR
.***
...CPRUD
.se MOREGNR=substr &kto 1 4
.se MOKTONR=substr &kto 5 6
.if .&U'&*2 = .DEPOT
.th .se kto    = 0&kto
.se MOREGNR1=substr &kto 1 4
.se MOKTONR1=substr &kto 5 6
.se MOK    =substr &kto 11 1
.*
...BEREGN
.if .&U'&*2 = .CPR
.or .&U'&*2 = .CVR
.th .go LOOPUD
.se LOOPEXIT = 0
...NUL
.se LOOPEXIT = &LOOPEXIT + 1
.if &LOOPEXIT > 15
.th .QQ
.if &L'&MOKTONR < 6
.th .se MOKTONR = 0&MOKTONR
.th .go NUL
...LOOPUD
.se NR = &MOREGNR1.&MOKTONR1
.if &L'&NR = 10
.th .go LNGOK
.mg /t/  Fejl10 i MO11CHK - kontakt RDF - længde af NR &NR = &L'&NR
...LNGOK
.* ISOLATION AF ENKELTE CIFRE BAGFRA (10 stk) Kontrolværdi er nr. 11
.se TEST1  = substr &NR 10 1
.se TEST2  = substr &NR 9 1
.se TEST3  = substr &NR 8 1
.se TEST4  = substr &NR 7 1
.se TEST5  = substr &NR 6 1
.se TEST6  = substr &NR 5 1
.se TEST7  = substr &NR 4 1
.se TEST8  = substr &NR 3 1
.se TEST9  = substr &NR 2 1
.se TEST10 = substr &NR 1 1
.* VÆGTNING AF ENKELTE CIFRE + SUM af vægte i TSTV
.se TSTV   = &TEST1 * 2
.se TSTSUM = &TSTV
.se TSTV   = &TEST2 * 3
.se TSTSUM = &TSTSUM + &TSTV
.se TSTV   = &TEST3 * 4
.se TSTSUM = &TSTSUM + &TSTV
.se TSTV   = &TEST4 * 5
.se TSTSUM = &TSTSUM + &TSTV
.se TSTV   = &TEST5 * 6
.se TSTSUM = &TSTSUM + &TSTV
.se TSTV   = &TEST6 * 7
.se TSTSUM = &TSTSUM + &TSTV
.se TSTV   = &TEST7 * 2
.se TSTSUM = &TSTSUM + &TSTV
.se TSTV   = &TEST8 * 3
.se TSTSUM = &TSTSUM + &TSTV
.se TSTV   = &TEST9 * 4
.se TSTSUM = &TSTSUM + &TSTV
.se TSTV   = &TEST10 * 5
.se TSTSUM = &TSTSUM + &TSTV
.**** VÆGTET SUM DIVIDERET MED 11 ***
.se REST = &TSTSUM. / 11
.se RESTB = &REST * 11
.se REST11 = &TSTSUM - &RESTB
.se KONTROL = 11 - &REST11
.if .&KONTROL = .11
.th .se KONTROL = 0
.go SLUT
.*
...SLUT
.if .&MOK = .&KONTROL
.th .se MO11CHK=1
.el .se MO11CHK=0
.*
.if .&U'&*2 = .VIS
.or .&U'&*3 = .VIS
.el .go SLUT2
kommando= &*       ;.br
Param1  = &*1      ;.br
Param2  = &*2      ;.br
kto     = &kto     ;.br
moregnr1= &MOREGNR1 ;.br
moktonr1= &MOKTONR1 ;.br
moregnr = &MOREGNR ;.br
moktonr = &MOKTONR ;.br
mok     = &MOK     ;.br
kontrol = &KONTROL ;.br
mo11chk = &MO11CHK ;.br
NR (tilrettet) = &NR ;.br
 Vægt sum &TSTSUM REST &REST RESTB &RESTB REST11 &REST11 KONTROL &KONTROL
 &TEST10 &TEST9 &TEST8 &TEST7 &TEST6 &TEST5 &TEST4 &TEST3 &TEST2 &TEST1
 ---------
.*
...SLUT2
.dm off
.* Macro BKMO modulus 10 kontollere Regnr. der begynder med 76
.* Macro BKMO modulus 11 kontollere Regnr. der begynder med 08
.* Melder fejl = 1
.* B37MO10CHK med macro MO10CHK skal være indlæst først
.* B37MO11CHK med macro MO11CHK skal være indlæst først
.* MODULUSKONTROL AF INDTASTEDE KONTONUMRE
.dm bkmo on
.if &L'&* = 0
.th .go N2
.se bk = SUBSTR &* 1 2
.***
.if x&bk = x76
.or x&bk = x08
.el .go N1
.*** MOD10 ***
.if x&bk = x76
.th .MO10CHK &*
.if x&MO10CHK eq x1
.th .go N2
.*** MOD11 ***
.if x&bk = x08
.th .MO11CHK &*
.if x&MO11CHK eq x1
.th .go N2
.* RESULTAT &MO10CHK - &MOREGNR - &MOKTONR - &KONTROL - &MOK - MO10CHK
.se fejl = 1
.mg /i/  Modulusfejl i reg.konto &*
.go N2
...N1
.se fejl = 1
.mg /i/  Fejl        i reg.nr.   &*
...N2
.dm off
.* MACRO IBAN der leverer kontonr som &IBAN1 &IBAN2 osv. eller nyste &IBAN
.* eks. .IBAN REGKONTONR KONTROLKODE
.* eks. .IBAN &B37REGKTO &B37N20
.* eks. &IBAN (reg-konto = IBANNR)
.se IBTAL = 0
.dm IBAN on
.se IBTAL = &IBTAL + 1
.if x&L'&*1 = x0
.th .go ktTOM
.se kt = &*1                       ;.* Reg.Kontonr
.se kk = &*2                       ;.* kontrolkode
.se r = SUBSTR &kt 1 4             ;.* Regnr.
.se k = SUBSTR &kt 5 7             ;.* Kontonr.
.se IBANNR&IBTAL. 'DK&kk.&r.000&k.'       ;.* IBANNR
.se IBANNR        'DK&kk.&r.000&k.'       ;.* IBANNR
.se IBAN&IBTAL. = '&r. &k. = &IBANNR.'    ;.* IBAN (oversættelsesstreng)
.se IBAN        = '&r. &k. = &IBANNR.'    ;.* IBAN (oversættelsesstreng)
.if x&L'&kk = x2
.th .go kkOK
.se fejl = 1
.mg /i/  Kontrolkode eller kontonr. mangler &*1
...kkOK
.go IBANSL
...ktTOM
.se IBANNR&IBTAL. ''       ;.* IBANNR
.se IBANNR        ''       ;.* IBANNR
.se IBAN&IBTAL. = ''       ;.* IBAN (oversættelsesstreng)
.se IBAN        = ''       ;.* IBAN (oversættelsesstreng)
...IBANSL
.dm off
...TSTSL

